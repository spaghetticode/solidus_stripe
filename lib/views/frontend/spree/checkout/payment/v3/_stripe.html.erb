<%= render 'spree/checkout/payment/v3/form_elements', payment_method: payment_method %>

<script src="/assets/frontend/stripe_init.js"></script>

<script>
  var cardNumber = initElements();

  cardNumber.addEventListener('change', function(event) {
    if (event.error) {
      errorElement.text(event.error.message).show();
    } else {
      errorElement.hide().text('');
    }
  });

  form.bind('submit', function(event) {
    if (element.is(':visible')) {
      event.preventDefault();

      stripe.createToken(cardNumber).then(function(result) {
        if (result.error) {
          errorElement.text(result.error.message).show();
          setTimeout(function() {
            $.rails.enableElement(submitButton[0]);
            submitButton.removeAttr('disabled').removeClass('disabled');
          }, 100);
        } else {
          stripeTokenHandler(result.token);
          form[0].submit();
        }
      });
    }
  });
</script>
